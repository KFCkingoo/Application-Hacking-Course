## h4 Some Disassembly Required 
Harjoitukset on tehty keväällä Teron ja Larin 2026 Sovellusten hakkerointi ja haavoittuvuudet - ICI012AS3A-3003 kurssia varten.

### x) Lue ja tiivistä
Videossa käydään läpi picoCTF bbbloat haastetta.

Ghidralla käänteistulkinta ja hakkerointi.

---

### a) Install Ghidra.
Asennettiin Java ja Ghidra.

```
sudo apt install openjdk-21-jdk
wget https://github.com/NationalSecurityAgency/ghidra/releases/download/Ghidra_12.0.2_build/ghidra_12.0.2_PUBLIC_20260129.zip
unzip ghidra_12.0.2_PUBLIC_20260129.zip
```


### b) rever-C. Reverse engineer the packd binary to C language with Ghidra. Find the main program. Give variables descriptive names. Explain the program's operation. Solve the task from the binary, without the original source code.
Importattiin packd tiedosto Ghidraan ja käänteistulkittiin se. Etsittiin sieltä pääohjelma. Voitiin päätellä näistä pääohjelma :

<img width="165" height="236" alt="kuva" src="https://github.com/user-attachments/assets/43be6cd7-5722-4c81-b837-92500ea2aa55" />

>_Erottuva funktio_

<img width="458" height="217" alt="kuva" src="https://github.com/user-attachments/assets/fa503c00-0a05-4dee-be7b-82bb28289d86" />
<img width="304" height="220" alt="kuva" src="https://github.com/user-attachments/assets/1e0343f5-6cbb-465b-9f5d-cd18eebc359e" />

>_Stringi mikä johtaa samaan funktioon_

Vaihdettiin pääfunktiolle nimi `main` ja muuttujalle `password`

<img width="315" height="271" alt="kuva" src="https://github.com/user-attachments/assets/b5c1550d-adf0-4405-bdd8-2058f5a342e1" />

Tästä eteenpäin emme edennyt, joten purettiin tiedosto UPX-ohjelmalla selkokieliseksi ja vietiin se Ghidraan. Aikaisemmat `main` ja `password` muutoksia ei tallennettu ennen käänteismallia...

<img width="576" height="274" alt="kuva" src="https://github.com/user-attachments/assets/8b27f4ba-3a40-4cea-8d51-204667428b9a" />

Ohjelman tarkoitus oli tehdä salasanakysely if-ehdolla. Ohjelman toiminnan syvempään ymmärrykseen ja selitykseen kuitenkin hyödynnettiin tekoälyä.

`int iVar1;` säilyttää salasanan.

`char local_28 [32];` käyttäjän syöte.

`__isoc99_scanf(&DAT_0010201d,local_28);` lukee syötteen puskuriin local_28. &DAT_0010201d on tekoälyn mukaan stringi "%s".

`iVar1 = strcmp(local_28, "piilos-AnAnAs");` Syötteen vertailu salasanaan.

if-else-ehdot tulostaa tekstit ehtojen mukaan.

Salasana tuli esiin käänteismallissa `piilos-AnAnAs` ja on sama salasana kuin edellisessä harjoituksessa.

<img width="696" height="57" alt="kuva" src="https://github.com/user-attachments/assets/8351ddc8-fae5-4590-ba31-b36dd4a9537b" />

---

### c) If backwards. Modify the passtr program's binary (without the original source code) so that it accepts all passwords except the correct one. Demonstrate with tests that the program works.
Etsittiin main ohjelma Symbol Tree listauksesta. Tässä tehtävässä se oli jo nimetty main valmiiksi. Oli todennäköistä, että tehtävän suorittamiseen vaati if-else ehdon muokkaamista.

Tutkittiin if-ehtoa ja se vei JNZ koodiin, rivistä lähtee sivusta nuoli toiselle koodille. Tutkittiin JNZ koodia ja if-ehtoa lisää.
Kokeiltiin vaihtaa `JNZ` hyppyä vastaikkaiseen `JZ` hyppyyn, jotta se muuttaisi hypyn ehtoa vaihtamatta lähdekoodia. Exportattiin tiedosto ja annettiin suoritusoikeudet `chmod 700 passtr` ennen kokeilua.

<img width="695" height="180" alt="kuva" src="https://github.com/user-attachments/assets/2e3d4e1d-bbbb-4cbc-989f-b67f82783a94" />

---

### d) Nora CrackMe: Compile to binaries Tindall 2023
`git clone https://github.com/NoraCodes/crackmes.git`

---

### e) Nora crackme01. Solve the binary.
<img width="485" height="37" alt="kuva" src="https://github.com/user-attachments/assets/0e7e5a44-7f65-48d2-a8aa-92f6e18370ed" />

>_Ajettiin ohjelma ja ei tullut kyselyä._

Katsottiin binääri `strings` komennolla. Salasana on password1.

Lisättiin salasana argumentiksi komennon päätyyn.

<img width="583" height="38" alt="Näyttökuva 2026-02-07 041313" src="https://github.com/user-attachments/assets/fd5f4dc4-0a27-4036-9879-9000ebfbed52" />

---

### e) Nora crackme01e. Solve the binary.
Tehtiin tehtävä samanlailla kuin edellinen tehtävä. Ei hyväksynyt argumenttia `!`-merkin takia.

Kokeiltiin syöttää argumentti heittomerkeillä tekstityypiksi.

<img width="622" height="81" alt="kuva" src="https://github.com/user-attachments/assets/5ab12a4f-443e-4a22-9f87-1f7024c56243" />

---

### f) Nora crackme02. Name the main program's variables from the reverse-engineered binary and explain the program's operation. Solve the binary.
Testattiin stringistä löytynyt argumentti:

<img width="582" height="39" alt="kuva" src="https://github.com/user-attachments/assets/8197d61e-e839-474e-a7e8-54bf464cf378" />

Käänteistulkittiin Ghidralla. Vaihdettiin cVar1-muuttujan nimeksi `syöttö?` ja se vaihtoi sen sijaan lVar4 nimen vaikka valittiin cVar1.

Vaihdettiin cVar1 nimeksi `pw?` ja ei muutosta tullut paitsi muiden muuttujien numeron vaihto järjestyksessä.

Tehtävässä c) käytiin hieman läpi binääristä hyppyehtoja JNZ ja JZ. Ohjelman if-ehdoista löytyi JZ hyppyehto, mikä tekee hypyn salasanan hyväksymiseen kun tulos on 0.

<img width="585" height="227" alt="kuva" src="https://github.com/user-attachments/assets/953e61b8-4997-49e6-8c8c-084b1c0e79ed" />

Katsottiin sen if-ehtoa lisää. Samasta rivistä löytyy `'\0'`.

<img width="396" height="335" alt="kuva" src="https://github.com/user-attachments/assets/bcc8f51b-68d4-4d1a-b78a-dba92a3dafc1" />

Testattiin vaihtoehtoja hyppy-ehtoon jos salasana olisikin 0 tai \0. Syötteillä ei onnistunut, joten tutkittiin mikä '\0' oikein oli ja löytyi stackoverflowsta vanha posti, että se oli null character. Testattiin tyhjällä heittomerkillä ja se meni läpi.

<img width="532" height="152" alt="kuva" src="https://github.com/user-attachments/assets/b9a35150-4ba8-432b-ba0e-e763806d027d" />

Kuten aikaisemmat tehtävät, se vaatii yhden argumentin (salasana) ja tulostaa vaatimuksen jos ei ole syötetty argumenttia.

Osaamiset ei ollut riittävä, joten otettiin tekoälyltä tietoa lyhyesti selitykseen.

Ohjelma käy läpi merkki kerrallaan ja vertailee `password1` merkkijonoon erikoisilla säännöillä.


---

### Lähteet
Copilot ChatGPT5.1 https://copilot.microsoft.com/

GHIDRA for Reverse Engineering (PicoCTF 2022 #42 'bbbloat'). https://www.youtube.com/watch?v=oTD_ki86c9I

JE vs JNE vs JZ vs JNZ: Understanding the Differences in x86 Assembly. https://www.codestudy.net/blog/difference-between-je-jne-and-jz-jnz/#jne-jump-if-not-equal

What is the difference between NULL, '\0' and 0? https://stackoverflow.com/questions/1296843/what-is-the-difference-between-null-0-and-0
